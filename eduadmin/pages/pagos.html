<!doctype html>
<html lang="es" data-app="eduadmin">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduAdmin | Pagos</title>

  <link rel="stylesheet" href="/assets/css/variables.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/components.css">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/assets/js/supabaseClient.js"></script>
  <script src="/assets/js/context.js"></script>
  <script src="/assets/js/ui.js"></script>
</head>

<body>
  <div class="app-shell">

    <!-- SIDEBAR (UI) -->
    <aside class="sidebar">
      <div class="brand">
        <img id="uiAppLogo" src="/assets/img/eduadmin.jpeg" alt="EduAdmin" />
        <div class="titles">
          <b>EduAdmin</b>
          <span>Administración real</span>
        </div>
      </div>

      <!-- tu ui.js normalmente rellena/activa menú; si ya tienes nav fijo, déjalo como lo vienes usando -->
      <nav class="nav" id="uiSidebarNav">
        <!-- opcional: si tu ui.js lo inyecta, esto puede quedar vacío -->
        <a href="/eduadmin/pages/dashboard.html"><div class="nav-item">Dashboard</div></a>
        <a href="/eduadmin/pages/concepto-pago.html"><div class="nav-item">Conceptos de pago</div></a>
        <a class="active" href="/eduadmin/pages/pagos.html"><div class="nav-item">Pagos</div></a>
      </nav>

      <div class="sidebar-footer">
        <div class="muted" style="padding:10px 12px;font-size:12px;">
          <div><b id="uiSchoolName">—</b></div>
          <div id="uiYearName">—</div>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <!-- TOPBAR (UI) -->
      <header class="topbar">
        <div class="topbar-left">
          <h1 style="margin:0;font-size:18px;">Pagos</h1>
          <div class="muted" style="font-size:12px;">Registra y controla pagos por concepto</div>
        </div>

        <div class="topbar-right" style="display:flex;gap:10px;align-items:center;">
          <div class="pill">
            <span class="muted">Usuario:</span>
            <b id="uiUserName">—</b>
          </div>
          <button class="btn btn-outline" id="btnRefresh" type="button">Actualizar</button>
          <button class="btn" id="btnNuevoPago" type="button">+ Nuevo pago</button>
        </div>
      </header>

      <!-- STATUS -->
      <div id="status" class="muted" style="margin:10px 2px 0;"></div>

      <!-- FILTROS -->
      <section class="card" style="margin-top:12px;">
        <div class="card-header">
          <b>Filtros</b>
          <span class="muted" style="font-size:12px;">(colegio + año académico se toman del contexto)</span>
        </div>

        <div class="card-content">
          <div class="grid" style="grid-template-columns: repeat(6, minmax(0, 1fr)); gap:10px;">
            <div>
              <label class="label">Alumno</label>
              <select id="fAlumno" class="select">
                <option value="">Todos</option>
              </select>
            </div>

            <div>
              <label class="label">Concepto</label>
              <select id="fConcepto" class="select">
                <option value="">Todos</option>
              </select>
            </div>

            <div>
              <label class="label">Periodo</label>
              <input id="fPeriodo" class="input" placeholder="Ej: Marzo, 2026-03, B1" />
            </div>

            <div>
              <label class="label">Estado</label>
              <select id="fEstado" class="select">
                <option value="">Todos</option>
                <option value="PAGADO">PAGADO</option>
                <option value="PENDIENTE">PENDIENTE</option>
                <option value="ANULADO">ANULADO</option>
              </select>
            </div>

            <div>
              <label class="label">Buscar</label>
              <input id="fBuscar" class="input" placeholder="Nombre / DNI / referencia..." />
            </div>

            <div style="display:flex;gap:8px;align-items:flex-end;">
              <button class="btn btn-outline" id="btnLimpiar" type="button">Limpiar</button>
              <button class="btn" id="btnFiltrar" type="button">Aplicar</button>
            </div>
          </div>
        </div>
      </section>

      <!-- TABLA -->
      <section class="card" style="margin-top:12px;">
        <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <b>Registro de pagos</b>
          <div class="muted" style="font-size:12px;">
            Total: <b id="kpiTotal">0</b> | Pagado: <b id="kpiPagado">0</b> | Pendiente: <b id="kpiPendiente">0</b>
          </div>
        </div>

        <div class="card-content" style="overflow:auto;">
          <table class="table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Alumno</th>
                <th>Concepto</th>
                <th>Periodo</th>
                <th>Monto</th>
                <th>Método</th>
                <th>Estado</th>
                <th>Ref.</th>
                <th style="width:160px;">Acciones</th>
              </tr>
            </thead>
            <tbody id="tbodyPagos">
              <tr><td colspan="9" class="muted">Cargando...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- MODAL NUEVO/EDITAR PAGO -->
      <div class="modal" id="modalPago" style="display:none;">
        <div class="modal-backdrop" data-close="1"></div>
        <div class="modal-dialog" role="dialog" aria-modal="true">
          <div class="modal-header">
            <b id="modalTitle">Nuevo pago</b>
            <button class="icon-btn" id="btnCerrarModal" type="button">✕</button>
          </div>

          <div class="modal-body">
            <div class="grid" style="grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px;">
              <div>
                <label class="label">Alumno *</label>
                <select id="pAlumno" class="select"></select>
              </div>

              <div>
                <label class="label">Concepto *</label>
                <select id="pConcepto" class="select"></select>
              </div>

              <div>
                <label class="label">Periodo</label>
                <input id="pPeriodo" class="input" placeholder="Ej: Marzo / 2026-03 / B1" />
              </div>

              <div>
                <label class="label">Fecha de pago *</label>
                <input id="pFecha" type="date" class="input" />
              </div>

              <div>
                <label class="label">Monto *</label>
                <input id="pMonto" type="number" step="0.01" class="input" placeholder="0.00" />
              </div>

              <div>
                <label class="label">Método</label>
                <select id="pMetodo" class="select">
                  <option value="">—</option>
                  <option value="EFECTIVO">EFECTIVO</option>
                  <option value="YAPE">YAPE</option>
                  <option value="PLIN">PLIN</option>
                  <option value="TRANSFERENCIA">TRANSFERENCIA</option>
                  <option value="TARJETA">TARJETA</option>
                </select>
              </div>

              <div>
                <label class="label">Estado</label>
                <select id="pEstado" class="select">
                  <option value="PAGADO">PAGADO</option>
                  <option value="PENDIENTE">PENDIENTE</option>
                  <option value="ANULADO">ANULADO</option>
                </select>
              </div>

              <div>
                <label class="label">Referencia</label>
                <input id="pRef" class="input" placeholder="Operación / voucher / nota" />
              </div>
            </div>

            <div style="margin-top:10px;">
              <label class="label">Observación</label>
              <textarea id="pObs" class="input" rows="3" placeholder="Opcional..."></textarea>
            </div>

            <div id="modalMsg" class="muted" style="margin-top:10px;"></div>
          </div>

          <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;">
            <button class="btn btn-outline" id="btnCancelarPago" type="button">Cancelar</button>
            <button class="btn" id="btnGuardarPago" type="button">Guardar</button>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script src="/eduadmin/js/pagos.js"></script>
</body>
</html>