<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Crear usuario</title>
</head>
<body>

<h2>Crear usuario</h2>

<input id="dni" placeholder="DNI"><br><br>
<input id="colegio" placeholder="Colegio UUID"><br><br>

<select id="role">
<option value="docente">docente</option>
<option value="alumno">alumno</option>
<option value="apoderado">apoderado</option>
<option value="director">director</option>
</select>

<br><br>
<button onclick="crear()">Crear</button>

<pre id="r"></pre>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="../../assets/js/supabaseClient.js"></script>

<script>
async function crear(){

  const sb = window.supabase;

  // ðŸ”´ obtener sesiÃ³n
  const { data: sess } = await sb.auth.getSession();
  const token = sess?.session?.access_token;

  if(!token){
    alert("No hay sesiÃ³n activa. Debes loguearte primero.");
    return;
  }

  const res = await fetch("/.netlify/functions/create-user",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + token
    },
    body:JSON.stringify({
      dni: document.getElementById("dni").value.trim(),
      role: document.getElementById("role").value,
      colegio_id: document.getElementById("colegio").value.trim(),
      must_change_password: true
    })
  });

  const txt = await res.text();
  document.getElementById("r").textContent = txt;
}
</script>

</body>
</html>